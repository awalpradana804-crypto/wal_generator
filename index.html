<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAL ADMIN PANEL STABLE</title>
    <style>
        :root { --violet: #8b5cf6; --cyan: #06b6d4; --dark: #0f172a; --white: #f8fafc; --red: #ef4444; }
        body { background: var(--dark); color: var(--white); font-family: sans-serif; display: flex; justify-content: center; padding: 20px; }
        .container { width: 100%; max-width: 450px; background: #1e293b; border: 2px solid var(--violet); border-radius: 15px; padding: 20px; text-align: center; }
        .btn { display: block; width: 100%; padding: 12px; margin: 10px 0; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; }
        .btn-violet { background: var(--violet); }
        .btn-cyan { background: var(--cyan); }
        input { width: 100%; padding: 10px; margin-top: 5px; background: #0f172a; border: 1px solid var(--violet); color: white; border-radius: 8px; box-sizing: border-box; }
        .status { font-size: 0.8rem; margin: 10px 0; padding: 10px; border-radius: 8px; background: #334155; }
        table { width: 100%; margin-top: 20px; border-collapse: collapse; font-size: 0.8rem; }
        th, td { border: 1px solid #334155; padding: 8px; text-align: left; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="color: var(--violet);">WAL ADMIN PANEL</h2>
    <div id="sync-status" class="status">Status: Ready</div>
    
    <input type="password" id="gh-token" placeholder="Paste GitHub Token (ghp_...)">
    
    <button class="btn btn-violet" onclick="createKey()">+ CREATE NEW KEY</button>
    <button class="btn btn-cyan" onclick="autoSync()">SINKRON KE GITHUB</button>

    <table>
        <thead><tr><th>KEY</th><th>DUR</th><th>AKSI</th></tr></thead>
        <tbody id="key-table-body"></tbody>
    </table>
</div>

<script>
    // KONFIGURASI - PASTIKAN USERNAME BENAR (DENGAN HURUF 'N')
    const GH_OWNER = "awalpradana804-crypto"; 
    const GH_REPO = "wal_generator";
    const GH_PATH = "keys.json";

    let keys = JSON.parse(localStorage.getItem('wal_keys')) || [];
    renderTable();

    function createKey() {
        let dur = prompt("Durasi (Hari):", "30");
        if (dur) {
            keys.push({ key: "WAL-"+Math.random().toString(36).substring(2,9).toUpperCase(), dur: parseInt(dur), tgl_raw: Date.now() });
            save();
        }
    }

    function save() {
        localStorage.setItem('wal_keys', JSON.stringify(keys));
        renderTable();
    }

    function renderTable() {
        const tbody = document.getElementById('key-table-body');
        tbody.innerHTML = keys.map((k, i) => `<tr><td>${k.key}</td><td>${k.dur}d</td><td><button onclick="del(${i})">X</button></td></tr>`).join('');
    }

    function del(i) { keys.splice(i, 1); save(); }

    async function autoSync() {
        const token = document.getElementById('gh-token').value;
        const status = document.getElementById('sync-status');
        if(!token) return alert("Isi Token Dulu!");

        status.innerText = "Menghubungkan...";
        try {
            // Ambil data file untuk dapatkan SHA
            const res = await fetch(`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${GH_PATH}`, {
                headers: { "Authorization": `token ${token}` }
            });
            
            if(!res.ok) {
                const errData = await res.json();
                throw new Error(errData.message || "Gagal akses Repo");
            }

            const fileData = await res.json();
            const content = btoa(JSON.stringify(keys, null, 2));

            // Kirim update
            const putRes = await fetch(`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${GH_PATH}`, {
                method: "PUT",
                headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" },
                body: JSON.stringify({ message: "Update via Web", content: content, sha: fileData.sha })
            });

            if(putRes.ok) {
                status.innerText = "SUCCESS: Berhasil Sinkron!";
                status.style.background = "green";
            } else {
                throw new Error("Gagal Update file");
            }
        } catch (e) {
            status.innerText = "ERROR: " + e.message;
            status.style.background = "red";
            console.error(e);
        }
    }
</script>
</body>
</html>
